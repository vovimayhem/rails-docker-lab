#! /bin/sh

echo "========================================="

# 1: Check Dependencies:
bundle check || bundle install --jobs=4 --retry=3

# 2: Check if the database exists:
checkdb || rails db:setup

# 3: Remove any leftover pid files:
if [ "$2" = "s" ] || [ "$2" = "server" ]
then
  rm -rf /usr/src/tmp/pids/server.pid
fi

# 4: Execute the given or default command:
exec "$@"
